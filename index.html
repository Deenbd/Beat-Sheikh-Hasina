<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juta Maro Game Comment</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'SolaimanLipi',Arial,sans-serif;background:#d3413f;height:100vh;display:flex;flex-direction:column}
        #box{flex:1;overflow-y:auto;padding:20px;padding-bottom:140px}
        .c{background:#efc7c7;padding:14px 16px;margin-bottom:12px;border-radius:10px;animation:a .4s}
        @keyframes a{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:none}}
        .h{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}
        .n{font-weight:bold;color:#800909}
        .t{font-size:11px;color:#800909;opacity:0.8}
        .m{color:#333;line-height:1.5}
        .inp{position:fixed;bottom:0;left:0;right:0;background:#772524;padding:16px;box-shadow:0 -3px 15px rgba(0,0,0,0.2)}
        .r{display:flex;gap:12px;align-items:center;margin-bottom:10px}
        input{flex:1;padding:14px;border:2px solid #ddd;border-radius:30px;outline:none;font-size:15px}
        input:focus{border-color:#2196F3}
        button{background:none;border:none;cursor:pointer;width:52px;height:52px}
        button img{width:28px;height:28px}
        button:disabled{opacity:0.4}
        .spin img{animation:s 1s linear infinite}
        @keyframes s{to{transform:rotate(360deg)}}
    </style>
</head>
<body>

<div id="box">Loading...</div>

<div class="inp">
    <div class="r">
        <input type="text" id="n" placeholder="Enter your name" maxlength="40">
        <button onclick="ref()" id="rb"><img src="reload.png"></button>
    </div>
    <div class="r">
        <input type="text" id="m" placeholder="Enter your comment" maxlength="400">
        <button onclick="send()" id="sb"><img src="send.png" id="si"></button>
    </div>
</div>

<script>
const URL = 'https://script.google.com/macros/s/AKfycbwe8K2zvdaB9rKisPx-zgMZ2Fw_RBn0OhvvYitDYrQPQHKKcgCSIMuINw4IEIK19hEcfg/exec';

function load() {
    fetch(URL)
    .then(r=>r.json())
    .then(d=>{
        const box = document.getElementById('box');
        box.innerHTML = '';
        if(d.status!=='success' || !d.comments){
            box.innerHTML = '<div style="text-align:center;padding:50px;color:#fff">কিছু ভুল হয়েছে। রিফ্রেশ করুন।</div>';
            return;
        }
        if(d.comments.length===0){
            box.innerHTML = '<div style="text-align:center;padding:50px;color:#ddd">এখনো কোনো মেসেজ নেই</div>';
            return;
        }
        d.comments.forEach(c=>{
            const div = document.createElement('div');
            div.className = 'c';
            div.innerHTML = `
                <div class="h">
                    <div class="n">${e(c.name)}</div>
                    <div class="t">${f(c.timestamp)}</div>
                </div>
                <div class="m">${e(c.comment)}</div>
            `;
            box.appendChild(div);
        });
        box.scrollTop = box.scrollHeight;
    })
    .catch(()=>{ document.getElementById('box').innerHTML = '<div style="text-align:center;padding:50px;color:#fff">ইন্টারনেট চেক করুন</div>'; });
}

function f(iso){
    const d = new Date(iso);
    const now = new Date();
    const today = now.toDateString()===d.toDateString();
    const t = d.toLocaleTimeString('bn-BD',{hour:'numeric',minute:'2-digit',hour12:true})
              .replace('AM','AM').replace('PM','PM');
    return today ? 'Today '+t : d.toLocaleDateString('bn-BD',{day:'numeric',month:'short',year:'numeric'})+' '+t;
}

function send(){
    const name = document.getElementById('n').value.trim();
    const msg = document.getElementById('m').value.trim();
    if(!name){alert('Enter name');document.getElementById('n').focus();return;}
    if(!msg){alert('Type your comment');document.getElementById('m').focus();return;}

    document.getElementById('sb').disabled = true;
    document.getElementById('si').style.opacity = '0.4';

    fetch(URL,{method:'POST',body:new URLSearchParams({name:name,comment:msg})})
    .then(r=>r.json())
    .then(res=>{
        document.getElementById('sb').disabled = false;
        document.getElementById('si').style.opacity = '1';
        if(res.status==='success'){
            document.getElementById('m').value='';
            load();
        }else{
            alert('Error to send, please try again!');
        }
    })
    .catch(()=>{
        document.getElementById('sb').disabled = false;
        document.getElementById('si').style.opacity = '1';
        alert('You are in offline!');
    });
}

function ref(){
    document.getElementById('rb').classList.add('spin');
    load();
    setTimeout(()=>document.getElementById('rb').classList.remove('spin'),1000);
}

function e(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML;}

load();
document.getElementById('m').addEventListener('keypress',k=>{if(k.key==='Enter')send();});
document.getElementById('n').addEventListener('keypress',k=>{if(k.key==='Enter')document.getElementById('m').focus();});
</script>
</body>
</html>
